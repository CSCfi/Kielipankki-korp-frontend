<div ng-controller="ExtendedSearch">
    <div id="query_table" ng-controller="TokenList">
        <p class="cqp">cqp: {{getCQPString(data)}}</p>
    
    
    
        <div class="token query_token" ng-repeat="token in data track by $index" ng-controller="ExtendedToken">
            <div class="token_header">
                <i class="close_btn fa fa-times-circle-o fa-1"

                      ng-click="removeToken($index)"></i>
                <div style="clear:both;"></div>
            </div>
    
            <div class="args">
                <div class="and query_arg" ng-repeat="and in token.and_block">
                    <span ng-show="$index">och</span>
    
                    <div class="or_container">
                        <div class="or or_arg" ng-repeat="or in and">
                            <div class="left_col">
                                <img class="image_button remove_arg" src="img/minus.png" ng-click="removeOr(and, $index)">
                            </div>
                            <div class="right_col inline_block" style="margin-left: 5px;">
                                <div class="arg_selects">
                                    <select class="arg_type" 
                                        ng-options="obj | mapper:valfilter as obj.label | loc group by obj.group | loc for obj in types" ng-model="or.type" ng-change="setDefault(or)"></select>
                                    
                                    <select class="arg_opts" 
                                        ng-options="pair[1] as pair[0] | loc for pair in getOpts(or.type)" 
                                        ng-model="or.op" ></select>
                                </div>
                                <!-- <input class="arg_value" ng-model="or.val"> -->
                                <div token-value="typeMapping[or.type]" ng-model="or.val" or-obj="or" class="arg_val_container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="arg_footer">
                        <span class="link" ng-click="addOr(and)">eller</span>
                        <div style="clear:both;"></div>
                    </div>
                </div>
            </div>
    
            <div class="token_footer">
                <div>
                    <img src="img/plus.png" class="image_button insert_arg" ng-click="addAnd()">

                    <button popper class="btn btn-mini"><i class="fa fa-cog"></i></button>
                    <ul class="popper_menu dropdown-menu">
                        <li>
                            <a ng-click="toggleRepeat(token)" rel="localize[repeat]">Upprepa</a>
                        </li>
                        <li><a ng-click="toggleStart(token)" rel="localize[sent_start]">Meningsbörjan</a></li>
                        <li><a ng-click="toggleEnd(token)" rel="localize[sent_end]">Meningsslut</a></li>
                    </ul>

    
                    <div class="repeat" ng-show="token.repeat">
                        <span rel="localize[repeat]">Upprepa</span>
                        <input type="number" ng-model="token.repeat[0]" >
                        <span rel="localize[to]">till</span>
                        <input type="number" ng-model="token.repeat[1]">
                        <span rel="localize[times]">gånger</span>
                    </div>
    
                    <div style="clear:both;"></div>
                </div>
    
                <div class="lower_footer">
                    <span  class="lbound close_token" ng-show="token.bound.lbound">
                        <span rel="localize[sent_start]">Meningsbörjan</span>
                        <i class="fa fa-1 fa-times" ng-click="toggleStart(token)"></i>
                    </span>
                    <span class="rbound close_token" ng-show="token.bound.rbound">
                        <span rel="localize[sent_end]">Meningsslut</span>
                        <i class="fa fa-1 fa-times" ng-click="toggleEnd(token)"></i>
                    </span>
                </div>
    
                <!-- <button  ng-click="addAnd()">and</button> -->
            </div>
        <!-- <button ng-click="addToken()">+</button> -->
        </div>
        <img src="img/plus.png" class="image_button insert_token" ng-click="addToken()">
    </div>
    
    
    
            <!-- <div id="query_table"></div>
    
            <input id="removeLang" type="submit" value="Färre språk">
            <input id="linkedLang" type="submit" value="Fler språk">
            <input id="sendBtn" value="  Sök  " type="submit" rel="localize[search]" />
            <span rel="localize[within]"></span>
            <select class="within_select">
                <option value="sentence" rel="localize[within_sentence]">Mening</option>
                <option value="paragraph" rel="localize[within_paragraph]">Stycke</option>
            </select>
             -->
    <search-submit pos="right"></search-submit>
    <!-- <input id="strict_chk" type="checkbox"><label for="strict_chk">{{'strict' | loc}}</label> -->
</div>