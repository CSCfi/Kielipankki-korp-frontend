doctype html
html
  head
    meta(http-equiv='Content-Type', content='text/html; charset=UTF-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='description', content='Med Korp kan den språkligt nyfikna göra avancerade sökningar i stora mängder av skriven text.')

    // build:css styles/korp.css
    //- link(rel='stylesheet', type='text/css', href='styles/pagination.css')
    link(rel='stylesheet', type='text/css', href='styles/bootstrap.css')
    link(rel='stylesheet', href='components/SlickGrid/slick.grid.css', type='text/css', media='screen', charset='utf-8')
    link(rel='stylesheet', href='components/jReject/css/jquery.reject.css', type='text/css', media='screen', charset='utf-8')
    link(type='text/css', href='styles/ui_mods.css', rel='stylesheet')
    link(rel='stylesheet', type='text/css', href='styles/jquery.tooltip.css')
    link(rel='stylesheet', href='components/rickshaw/rickshaw.css')
    //- link(rel='stylesheet', type='text/css', href='components/font-awesome/css/font-awesome.css')

    link(rel='stylesheet', type='text/css', href='components/leaflet/dist/leaflet.css')
    link(rel='stylesheet', type='text/css', href='components/geokorp/dist/styles/geokorp.css')
    //- bower:css
    //- endbower
    // endbuild
    link(type='text/css', href='components/jquery-ui/themes/smoothness/jquery-ui.min.css', rel='stylesheet')


    link(rel='stylesheet', type='text/css', href='styles/styles.css')
    link(rel='shortcut icon', type='image/ico', href='img/korp_icon.ico')
    title Korp


  //- body.not_logged_in(ng-app='korpApp', style="opacity: 0;")
  body.not_logged_in(style="opacity: 0;")
    noscript
      h2 You need JavaScript to run Korp.
    //- script.
      //- $("body").css("opacity", 0);
    #main
      #header
        include includes/header
      #content
        include includes/searchtabs

        #results-wrapper(ng-show='searches.activeSearch || compareTabs.length || graphTabs.length', ng-controller='resultContainerCtrl')
          #columns
            //-ng-class='{sidebar_visible : word_selected && result_tab == 0}'
            #left-column(ng-class='{sidebar_visible : word_selected && sidebar_visible}')
              //- tabset.tabbable
              tabset.tabbable.result_tabs(tab-hash='result_tab', ng-click="tabclick()")
                tab(disabled="!instance.hasData",
                    select="instance.onentry()",
                    deselect="instance.onexit()",
                    ng-controller='kwicCtrl'
                )
                  tab-heading(ng-class="{not_loading: progress > 99, loading : loading, single: loading && instance.countCorpora() < 2 }")
                    | KWIC
                    tab-preloader(ng-if="loading", value="progress", spinner="instance.countCorpora() < 2")
                  .results-kwic(ng-class="{reading_mode : reading_mode, loading: loading}", constr='KWICResults', constr-name='kwicResults')
                    include includes/kwicresult
                //- disabled="!instance.hasData && !aborted",
                tab(ng-controller='StatsResultCtrl',
                    ng-if="_settings.statistics != false"
                    select="instance.onentry()"
                    deselect="instance.onexit()"

                    )
                  tab-heading(ng-class="{not_loading: progress > 99, loading : loading, single: loading && instance.countCorpora() < 2 }")
                    | {{'statistics' | loc:lang}}
                    tab-preloader(ng-if="loading", value="progress", spinner="instance.countCorpora() < 2")
                  div(constr='StatsResults', constr-name='statsResults')

                    warning(ng-if="no_hits")
                      | {{"no_stats_results" | loc:lang}}
                    warning(ng-if="aborted && !loading")
                      | {{'search_aborted' | loc:lang}}
                    .stats_header
                      button#showGraph.btn.btn-sm.btn-default(ng-class="{disabled: !graphEnabled}",
                        tooltip="{{graphEnabled ? '' : ('material_warn' | loc:lang)}} ", tooltip-placement="right"
                      )
                        span.graph_btn_icon
                          <svg height="24" version="1.1" width="33" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></defs><path fill="#666666" stroke="none" d="M3.625,25.062C3.086,24.947000000000003,2.74,24.416,2.855,23.875L2.855,23.875L6.51,6.584L8.777,15.843L10.7,10.655000000000001L14.280999999999999,14.396L18.163999999999998,1.293000000000001L21.098,13.027000000000001L23.058,11.518L28.329,23.258000000000003C28.555,23.762000000000004,28.329,24.353,27.824,24.579000000000004L27.824,24.579000000000004C27.319000000000003,24.806000000000004,26.728,24.579000000000004,26.502000000000002,24.075000000000003L26.502000000000002,24.075000000000003L22.272000000000002,14.647000000000002L19.898000000000003,16.473000000000003L18.002000000000002,8.877000000000002L15.219000000000003,18.270000000000003L11.465000000000003,14.346000000000004L8.386,22.66L6.654999999999999,15.577L4.811999999999999,24.288C4.710999999999999,24.76,4.297,25.082,3.8329999999999993,25.082L3.8329999999999993,25.082C3.765,25.083,3.695,25.076,3.625,25.062L3.625,25.062Z" transform="matrix(0.6,0,0,0.6,6.2499,5.275)" stroke-width="1.6666666666666667" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
                        | {{'show_diagram' | loc:lang}}

                      //- .progress_container
                      //-   progress(value='{{progress || 0}}', max='100')
                      #showBarPlot
                    #myGrid
                    #exportStatsSection
                      br
                      br
                      select#kindOfData
                        option(value='relative', rel='localize[statstable_relfigures]') Relativa tal
                        option(value='absolute', rel='localize[statstable_absfigures]') Absoluta tal
                      select#kindOfFormat
                        option(value='csv', rel='localize[statstable_exp_csv]') CSV (kommaseparerade värden)
                        option(value='tsv', rel='localize[statstable_exp_tsv]') TSV (tabseparerade värden)
                      a#generateExportButton
                        button.btn.btn-sm.btn-default {{'statstable_gen_export' | loc:lang}}
                      a#exportButton.btn.btn-sm.btn-default
                        | {{'statstable_export' | loc:lang}}
                tab(ng-if="_settings.wordpicture != false",
                    ng-controller="wordpicCtrl",
                    select="instance.onentry()",
                    deselect="instance.onexit()")
                  tab-heading(ng-class="{not_loading: progress > 99, loading : loading, single: loading && instance.countCorpora() < 2 }")
                    | {{'word_picture' | loc:lang}}
                    tab-preloader(ng-if="loading", value="progress", spinner="instance.countCorpora() < 2")
                  div.wordpic_disabled(ng-if="!word_pic")
                    | {{'word_pic_warn' | loc:lang}}
                    div
                      button.btn.btn-sm.btn-default.activate_word_pic(ng-click="activate()")
                        | {{'word_pic_warn_btn' | loc:lang}}

                  warning(ng-if="word_pic && !instance.hasData && !loading && !aborted")
                    | {{'word_pic_bad_search' | loc:lang}}
                  warning(ng-if="word_pic && aborted && !loading")
                    | {{'search_aborted' | loc:lang}}
                  warning(ng-if="word_pic && no_hits")
                    | {{"no_stats_results" | loc:lang}}
                  div(constr='LemgramResults', constr-name='lemgramResults')
                    #wordclassChkParent(ng-show="word_pic && instance.hasData")
                      input#wordclassChk(type='checkbox')
                      label(for='wordclassChk', rel='localize[show_wordclass]')
                    //- .progress_container
                    //-   progress(value='{{progress || 0}}', max='100')
                    .content_target(ng-show="word_pic")
                tab(ng-show="enableMap" ng-controller="MapCtrl")
                  tab-heading(ng-class="{not_loading: progress > 99, loading : loading, single: loading && countCorpora() < 2 }")
                    | {{'map' | loc:lang }}
                    tab-preloader(ng-if="loading", value="progress", spinner="countCorpora() < 2")
                  div()
                    include includes/mapresult

                include includes/dynamic_result_tabs

              a#json-link(ng-href='{{jsonUrl}}', ng-show="jsonUrl", target="_blank")
                img(src='img/json.png')
            //- ng-class='{visible : word_selected && result_tab == 0}'
            #sidebar.ui-corner-all.kwic_sidebar(ng-class='{visible : word_selected && sidebar_visible}')
            div(style='clear: both; float: none;')
      #click_cover
      #deptree_popup(title='Dependensträd', style='display: none;')
      #plot_popup
        #plot_canvas(style='width: 470px; height: 400px;')

    script#login_modal(type="text/ng-template").
      <div class="modal-header">
        <h2>{{'log_in' | loc:lang}}</h2>
        <span ng-click="clickX()" class="close-x">×</span>

      </div>
      <div id="login_popup" class="modal-body">
        <form ng-submit="loginSubmit(login_usr, login_pass)">
          <label for="usrname" rel="localize[username]">Epostadress</label>
          <input id="usrname" ng-model="login_usr" type="text">
          <label for="pass" rel="localize[password]">Lösenord</label>
          <input id="pass" ng-model="login_pass" type="password">
          <p rel="localize[login_fail_msg]" ng-show="login_err" class="err_msg">Login misslyckades, kontrollera användarnamn och lösenord och försök igen.</p>
          <input class="btn btn-sm btn-primary" type="submit" value="Logga in" rel="localize[send]" >
        </form>
      </div>


    script#lemgramResultsTmpl(type='text/x-jquery-tmpl').
      <div class="lemgram_section">
      {{if $data.length}}
      <div class='lemgram_help' />
      {{tmpl($data, {"lemgram" : $item.lemgram}) '#lemgramTableTmpl'}}
      {{/if}}
      </div>
    script#lemgramTableTmpl(type='text/x-jquery-tmpl').
      <div class="lemgram_result"
      {{if word}}
      data-word="${word}">
      <h3 id="display_word"></h3>
      {{else}}
      data-rel="${$data[0].rel}"
      data-show_rel="${$data[0].show_rel}">
      <table>
      {{tmpl($data, {"lemgram" : $item.lemgram}) '#lemgramRowTmpl'}}
      </table>
      {{/if}}
      </div>
    script#lemgramRowTmpl(type='text/x-jquery-tmpl').
      <tr>
      <td><span class="enumerate"/></td>
      <td data-lemgram="${$.grep($item.data[show_rel].split("|"), Boolean)[0]}" data-depextra="${depextra}"></td>
      <td title="${$.format("mi: %.2f", mi)}">${freq}</td>
      <td class="example_link"></td>
      </tr>
    //- script#similarTmpl(type='text/x-jquery-tmpl').
    //-   <li>
    //-   {{each rel}}
    //-   <a href="javascript:" data-lemgram="${$value}">${util.splitLemgram($value).form}</a>
    //-   {{/each}}
    //-   </li>


    //- scripts




    //if lte IE 8
      script(language='javascript', src='lib/flot/excanvas.min.js')
    script.
      var isLab = window.location.pathname.split("/")[1] == "korplabb";
      if(window.console == null) window.console = {"log" : $.noop, "error" : $.noop};
      window.c = window.console;

    // build:js scripts/korp_lib.js
    script(src='components/json3/lib/json3.js')
    script(src='components/jquery/dist/jquery.js')
    script(src='components/jquery-ui/ui/jquery.ui.core.js')
    script(src='components/jquery-ui/ui/jquery.ui.widget.js')
    script(src='components/jquery-ui/ui/jquery.ui.autocomplete.js')
    script(src='components/jquery-ui/ui/jquery.ui.button.js')
    script(src='components/jquery-ui/ui/jquery.ui.dialog.js')
    script(src='components/jquery-ui/ui/jquery.ui.effect.js')
    script(src='components/jquery-ui/ui/jquery.ui.effect-fade.js')
    script(src='components/jquery-ui/ui/jquery.ui.menu.js')
    script(src='components/jquery-ui/ui/jquery.ui.mouse.js')
    script(src='components/jquery-ui/ui/jquery.ui.position.js')
    script(src='components/jquery-ui/ui/jquery.ui.sortable.js')
    //- script(src='components/jquery-ui/ui/jquery.ui.slider.js')

    script(src='components/angular/angular.js')

    // warning: modified version of ui-bootstrap, see README in lib/angular-bootstrap
    script(src='lib/angular-bootstrap/ui-bootstrap-tpls.js')
    
    script(src='components/spin.js/spin.js')
    script(src='components/angular-spinner/angular-spinner.js')
    //- script(src='components/angular-slider/angular-slider.js')
    script(src='lib/angular-sortable.js')


    script(src='lib/jquery.localize.js')
    script(src='components/raphael/raphael.js')
    script(src='components/jReject/js/jquery.reject.js')
    //- script(src='components/angular-dynamic-locale/src/tmhDynamicLocale.js')
    script(src='lib/tmhDynamicLocale.js')
    script(src='lib/jquery.raphael.spinner.js')
    script(src='lib/jquery.format.js')
    //- script(src='lib/angular-locale_sv-se.js')

    script(src='components/modernizr/modernizr.js')
    script(src='components/jquery-bbq/jquery.ba-bbq.js')

    script(src='components/jstorage/jstorage.js')
    script(src='lib/jquery.hoverIntent.js')
    script(src='lib/jquery.ui.preloader.min.js')
    script(src='lib/jquery.tmpl.js')
    //- script(src='lib/jquery.pagination.js')
    script(src='lib/flot/jquery.flot.min.js')
    script(src='lib/flot/jquery.flot.stack.js')

    script(src='components/SlickGrid/slick.core.js')
    script(src='lib/jquery.event.drag-2.2.js')
    script(src='components/SlickGrid/slick.grid.js')
    script(src='components/SlickGrid/plugins/slick.checkboxselectcolumn.js')
    script(src='components/SlickGrid/plugins/slick.rowselectionmodel.js')

    script(src='scripts/jq_extensions.js')
    script(src='components/lodash/dist/lodash.js')
    script(src="components/underscore.string/lib/underscore.string.js")
    script(src='components/spin.js/spin.js')
    script(src='components/angular-spinner/angular-spinner.js')

    //- script(src='components/angular-bindonce/bindonce.js')
    script(src='components/angular-slider/slider.js')
    script(src='lib/angular-sortable.js')

    script(src='components/moment/moment.js')
    script(src='components/comma-separated-values/csv.js')
    //- not used currently
    //- bower:js
    //- endbower
    script(src='components/angular-simple-logger/dist/index.js')
    script.
      L_DISABLE_3D = true;
    script(src='components/leaflet/dist/leaflet.js')
    script(src='components/leaflet/dist/leaflet-src.js')
    script(src='components/angular-leaflet-directive/dist/angular-leaflet-directive.js')
    script(src='components/leaflet-providers/leaflet-providers.js')
    script(src='components/geokorp/dist/scripts/geokorp-templates.js')
    script(src='components/geokorp/dist/scripts/geokorp.js')
    script(src='components/angular-filter/dist/angular-filter.js')
    // endbuild
    script(src='lib/jquery.tooltip.pack.js')
    script(src='components/d3/d3.min.js')
    script(src='components/rickshaw/rickshaw.min.js')


    script.
      window.currentMode = $.deparam.querystring().mode || "default"

    script(src='config.js')
    // build:js scripts/scripts.js

    script(src='scripts/cqp_parser/CQPParser2.js')
    //- script(src='scripts/cqp_parser/CQPParser.js')
    script(src='scripts/bin/cqp_parser/cqp.js')
    script(src='scripts/bin/util.js')
    script(src='scripts/bin/pie-widget.js')
    script(src='scripts/bin/search.js')
    script(src='scripts/bin/results.js')
    script(src='scripts/bin/model.js')
    script(src='scripts/bin/widgets.js')
    script(src='scripts/bin/main.js')
    script(src='scripts/selector_widget.js')
    script(src='scripts/bin/app.js')
    script(src='scripts/bin/search_controllers.js')
    script(src='scripts/bin/result_controllers.js')
    script(src='scripts/bin/services.js')
    script(src='scripts/bin/directives.js')
    script(src='scripts/bin/newsdesk.js')
    // endbuild
