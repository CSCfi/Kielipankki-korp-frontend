$.widget("ui.preloader", {
	options : {
		appendTo : "body",
		timeout : 1000,
		preloaderClass : "ui-preloader",
		position : {
			my : "right center",
			at : "right center",
			offset : "-5 0",
			collision : "none"
		}
	},
	show : function() {
		var a = this;
		if(a.options.showdfd) a.options.showdfd.reject();
		a.preloader.show().position(a.options.position);
		a.options.timerdfd = $.Deferred(); 
		setTimeout(function() {
			a.options.timerdfd.resolve();
		}, a.options.timeout);
		
		a.options.showdfd = $.Deferred();
		
		$.when(a.options.showdfd, a.options.timerdfd).then(function() {
			a.preloader.hide();
		});
	},
	
	_create : function() {
		var a = this, b = a.element[0].ownerDocument;
		a.preloader = $("<b></b>")
			.spinner({innerRadius: 5, outerRadius: 7, dashes: 8, strokeWidth: 3})
			.addClass("ui-preloader").addClass(
				a.options.preloaderClass).hide().appendTo(
				$(a.options.appendTo || "body", b)[0]);
		a.options.position.of = a.options.position.of || a.element;
	},
	hide : function() {
		var a = this;
		if(a.options.showdfd)
			a.options.showdfd.resolve();
	},
	destroy : function() {
		$.Widget.prototype.destroy.apply(this, arguments)
	}
});